<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
	<title>渠道商</title>
  <link rel="stylesheet" href="../css/publicCss.css"/>
  <link rel="stylesheet" href="../css/animation.css"/>
	<style>
		.Home{
			width:100%;
			height:100%;
			background: #fff;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
		}
		.CheckIn{
			width:8.67rem;
			height:1.07rem;
			background: rgba(77, 123, 244, 1);
			color:rgba(255, 255, 255, 1);
			font-size:0.427rem;
			border-radius:0.67rem;
			text-align: center;
			line-height: 1.07rem;
		}
		.personal{
				margin-bottom:1.24rem;
		}
	</style>
</head>
<body>
	<div class="Home">
		<div class="personal CheckIn">个人入驻</div>
		<div class="enterprise CheckIn">企业入驻</div>
    
    <div class="alertDIv"></div>
	</div>
	<script src="../js/font.min.js"></script>
	<script src="../js/zepto.min.js"></script>
	<script src="../js/touch.js"></script>	
  <!-- <script src="../js/Gpublic.js"></script> -->
	<script>
  var unionid=''
  var miniapp=""
  var nickname=""
  var head_pic=""
  var sex=""
  var is_parent=""
// 获取域名
      var domainName=''//初始化域名
      if(window.location.protocol+"//"+window.location.host=="http://region.aibebi.net"){
          domainName='http://www.aibebi.net'
      }else{
          // domainName='http://ceshi.aibebi.net'
          domainName='http://www.aibebi.net'
      }
    if(unionid && miniapp && nickname && head_pic && sex){
        Islogin()
    }else{
        getCodes()
    }
// 登录接口
      function Islogin(){
        var personInfo= $.param({'unionid':unionid,'miniapp':miniapp,'nickname':nickname,'head_pic':head_pic,'sex':sex})
        // var personInfo= ''
         $.ajax({
                url:domainName+'/channel/add_logins',
                type:'post',
                async:false,
                datatype:'jsonp',
                data: personInfo,
                jsonp:"callback",
                success:function(res){
                  if(res.code==200){
                      var data=res.data
                      is_parent=data.result.is_parent
                      localStorage.setItem('token',data.result.token)
                  }else{
                        getCodes ()
                  }

                }
              })
      }
//获取code值
      function getUrlParam(name) {//封装方法
          var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
          var r = window.location.search.substr(1).match(reg); //匹配目标参数
          if (r != null) return unescape(r[2]);
          return null; //返回参数值
      }
// 获取微信用户
      function getCodes () {
          const AppId='wx0c2b0e01cb1d50b4';  //狐小游
          // const AppId='wx7cb8b9da4ff3bac2';//艾贝网
          const code=this.getUrlParam('code')
          const local=window.location.href
          if(code==null || code===''){
            window.location.href='https://open.weixin.qq.com/connect/oauth2/authorize?appid='+AppId+'&redirect_uri='+encodeURIComponent(local)+'&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect'
          }else{
              var personInfo= $.param({'code':code})
              $.ajax({
                url:domainName+'/channel/user_login',
                type:'post',
                async:false,
                datatype:'jsonp',
                data: personInfo,
                jsonp:"callback",
                success:function(res){
                  if(res.code==200){
                      unionid=res.data.unionid
                      nickname=res.data.nickname
                      head_pic=res.data.headimgurl
                      miniapp=res.data.miniapp
                      sex=res.data.sex
                      Islogin()                  
                    }else{
                    animationChange(data.msg)
                  }

                }
              })
          }
      }
	 $(".Home").on("tap",'.personal',function(){
      if(is_parent==1){
          window.location.href="ChannelProvider.html"
      }else if(is_parent==0){
          window.location.href="contract.html"
      }
		
	})
// 
	</script>
</body>
</html>