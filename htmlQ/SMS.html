<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
	<title>渠道商认证</title>
	<link rel="stylesheet" href="../css/SMS.css">
	<link rel="stylesheet" href="../css/publicCss.css"/>
	<link rel="stylesheet" href="../css/animation.css"/>
</head>
<body>
	<div class="Certi_wrapper">
		<div class="Certi_header">
			<span>短信验证</span>
			<div class="Certi_headerImg"><img src="../img/tuoyuan1.png" alt=""></div>
		</div>
		<ul class="Certi_center">
			<li><span>手机号码：</span><span class="phone"></span></li>
			<li>
				<span>短信验证码：</span>
				<input maxlength='4' oninput = "value=value.replace(/[^\d]/g,'')" name="SMSNum" type="text"  placeholder="请填写短信验证码">
				<button type="button" >获取验证码</button>

			</li>
		</ul>
		<div class="renSumbit">提交</div>
		<div class="alertDIv"></div>
    
	</div>	
	<script src="../js/font.min.js"></script>
	<script src="../js/zepto.min.js"></script>
	<script src="../js/touch.js"></script>	
	<script src="../js/Gpublic.js"></script>
	<!-- <script src="../js/renzheng.js"></script> -->
	<script>
    var disabled=true  //初始化'获取验证码按钮'能被点击
    var bb="" //认证带过来的信息
    var timer="" //初始化定时器
    var i=60  //秒数
		if(localStorage.getItem("aa")){ //认证页面带来的用户信息
			bb=JSON.parse(decodeURIComponent(window.atob(localStorage.getItem("aa"))))
      if(bb.mobile){
          $('.phone').text(bb.mobile)
      }
		}
		 //获取验证码
    $(".Certi_center").on("tap",'button',function(){
      if(disabled){
            disabled=false //'获取验证码按钮'不能被点击
            var PhoneNum=$('.phone').text() //手机号
            var personInfo= $.param({'mobile':PhoneNum,'scene':'23'})
                      $.ajax({
                        url:domainName+'/user/ver_tion',
                        type:'post',
                        async:false,
                        datatype:'jsonp',
                        data: personInfo,
                        jsonp:"callback",
                        success:function(res){
                             if(res.code==200){
                                    animationChange(res.data.msg)
                                    //  发送成功后秒数提示
                                    clearInterval(timer)
                                    timer=setInterval(function(){
                                        $('button')[0].innerHTML=i +"S"
                                        i--;
                                        if(i<0){
                                            i=60;
                                            $('button')[0].innerHTML='获取验证码'
                                            disabled=true
                                            clearInterval(timer)
                                        }
                                    },1000)
                             }else {
                                  disabled=true
                                  animationChange(res.msg)
                             }
                         }
                      })
              }
	   })
    // 提交
	$(".Certi_wrapper").on("tap",'.renSumbit',function(){
		var PhoneNum=$('.phone').text()
		var code=$("input[name='SMSNum']").val()
	 	var personInfo= $.param({'mobile':PhoneNum,'real_name':bb.real_name,'id_card':bb.id_card,'bank_card':bb.bank_card,code:code,'type':3})
              $.ajax({
                url:domainName+'/user/bang_Name',
               	type:'post',
                async:false,
                datatype:'jsonp',
                data: personInfo,
                jsonp:"callback",
                success:function(res){
                     if(res.code==200){
                     	 window.location.href="Review.html"
                     }else{
                        animationChange(res.msg)
                     }
                 },

              })
	})
	</script>
</body>
</body>
</html>